# SimplePySandbox æµ‹è¯•é‡æ„å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ ä»»åŠ¡å®Œæˆæ€»ç»“

å·²æˆåŠŸå®ŒæˆSimplePySandboxé¡¹ç›®çš„æµ‹è¯•ä»£ç é‡æ„å’Œç»„ç»‡å·¥ä½œï¼Œå°†æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ä»æ ¹ç›®å½•ç§»åŠ¨åˆ°åˆç†çš„ç›®å½•ç»“æ„ä¸­ã€‚

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. æµ‹è¯•ç›®å½•ç»“æ„é‡ç»„

**ä¹‹å‰çŠ¶æ€ï¼š** æµ‹è¯•æ–‡ä»¶æ•£è½åœ¨é¡¹ç›®æ ¹ç›®å½•
```
/Users/lildino/Project/SimplePySandbox/
â”œâ”€â”€ test_complete_system.py
â”œâ”€â”€ test_main.py
â”œâ”€â”€ test_security.py
â”œâ”€â”€ test_timeout.py
â”œâ”€â”€ test_api_timeout.py
â”œâ”€â”€ test_utils.py
â””â”€â”€ test_conda.py (ç©ºæ–‡ä»¶)
```

**é‡ç»„åï¼š** æŒ‰æµ‹è¯•ç±»å‹åˆ†ç±»ç»„ç»‡
```
tests/
â”œâ”€â”€ __init__.py                    # æµ‹è¯•åŒ…åˆå§‹åŒ–
â”œâ”€â”€ conftest.py                   # pytesté…ç½®å’Œå¤¹å…·
â”œâ”€â”€ README.md                     # æµ‹è¯•æ–‡æ¡£
â”œâ”€â”€ data/                         # æµ‹è¯•æ•°æ®
â”‚   â”œâ”€â”€ input.txt                # ç¤ºä¾‹è¾“å…¥æ–‡ä»¶
â”‚   â””â”€â”€ sample_code.py           # ç¤ºä¾‹ä»£ç æ–‡ä»¶
â”œâ”€â”€ unit/                        # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_security.py         # å®‰å…¨ç­–ç•¥æµ‹è¯•
â”‚   â””â”€â”€ test_utils.py            # å·¥å…·å‡½æ•°æµ‹è¯•
â”œâ”€â”€ integration/                 # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_main.py             # APIç«¯ç‚¹æµ‹è¯•
â”‚   â”œâ”€â”€ test_timeout.py          # è¶…æ—¶æœºåˆ¶æµ‹è¯•
â”‚   â”œâ”€â”€ test_api_timeout.py      # APIè¶…æ—¶æµ‹è¯•
â”‚   â””â”€â”€ test_environment.py      # ç¯å¢ƒç®¡ç†æµ‹è¯•
â”œâ”€â”€ system/                      # ç³»ç»Ÿæµ‹è¯•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_complete_system.py  # å®Œæ•´ç³»ç»Ÿæµ‹è¯•
â””â”€â”€ performance/                 # æ€§èƒ½æµ‹è¯•
    â”œâ”€â”€ __init__.py
    â””â”€â”€ test_performance.py      # æ€§èƒ½åŸºå‡†æµ‹è¯•
```

### 2. æµ‹è¯•è¿è¡Œå™¨å’Œè„šæœ¬

#### åˆ›å»ºäº†æ–°çš„æµ‹è¯•è¿è¡Œå™¨
- **`run_tests.py`**: Pythonæµ‹è¯•è¿è¡Œå™¨ï¼Œæ”¯æŒä¸åŒæµ‹è¯•ç±»å‹
- **æ›´æ–°äº† `test.sh`**: Bashæµ‹è¯•è„šæœ¬ï¼Œé›†æˆæ–°çš„æµ‹è¯•ç»“æ„

#### æ”¯æŒçš„æµ‹è¯•ç±»å‹
- `all`: è¿è¡Œæ‰€æœ‰æµ‹è¯•
- `unit`: å•å…ƒæµ‹è¯•
- `integration`: é›†æˆæµ‹è¯•  
- `system`: ç³»ç»Ÿæµ‹è¯•
- `performance`: æ€§èƒ½æµ‹è¯•
- `quick`: å¿«é€Ÿæµ‹è¯•ï¼ˆæ’é™¤æ…¢é€Ÿæµ‹è¯•ï¼‰
- `slow`: æ…¢é€Ÿæµ‹è¯•
- `docker`: éœ€è¦Dockerçš„æµ‹è¯•

#### è¿è¡Œé€‰é¡¹
- `-v, --verbose`: è¯¦ç»†è¾“å‡º
- `-c, --coverage`: ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
- `--no-setup`: è·³è¿‡ç¯å¢ƒè®¾ç½®

### 3. æµ‹è¯•æ ‡è®°ç³»ç»Ÿ

å®ç°äº†å®Œæ•´çš„pytestæ ‡è®°ç³»ç»Ÿï¼š
- `@pytest.mark.unit`: å•å…ƒæµ‹è¯•
- `@pytest.mark.integration`: é›†æˆæµ‹è¯•
- `@pytest.mark.system`: ç³»ç»Ÿæµ‹è¯•
- `@pytest.mark.performance`: æ€§èƒ½æµ‹è¯•
- `@pytest.mark.slow`: æ…¢é€Ÿæµ‹è¯•
- `@pytest.mark.requires_docker`: éœ€è¦Dockerç¯å¢ƒ

### 4. æµ‹è¯•å¤¹å…·å’Œé…ç½®

åˆ›å»ºäº† `conftest.py` æä¾›ï¼š
- `project_root`: é¡¹ç›®æ ¹ç›®å½•
- `test_data_dir`: æµ‹è¯•æ•°æ®ç›®å½•
- `temp_dir`: è‡ªåŠ¨æ¸…ç†çš„ä¸´æ—¶ç›®å½•
- `sample_code`: ç¤ºä¾‹ä»£ç é›†åˆ
- `api_base_url`: APIåŸºç¡€URL

### 5. æ–°å¢æµ‹è¯•æ–‡ä»¶

#### `test_environment.py` - ç¯å¢ƒç®¡ç†æµ‹è¯•
- æµ‹è¯•é»˜è®¤ç¯å¢ƒæ‰§è¡Œ
- æµ‹è¯•ç¯å¢ƒå‚æ•°åŠŸèƒ½
- æµ‹è¯•ç¯å¢ƒéš”ç¦»
- æµ‹è¯•åŒ…å¯ç”¨æ€§
- æµ‹è¯•å®‰å…¨é™åˆ¶

#### `test_performance.py` - æ€§èƒ½æµ‹è¯•
- å•æ¬¡æ‰§è¡Œæ€§èƒ½æµ‹è¯•
- å¹¶å‘æ‰§è¡Œæ€§èƒ½æµ‹è¯•
- å†…å­˜ä½¿ç”¨æ€§èƒ½æµ‹è¯•
- æ–‡ä»¶æ“ä½œæ€§èƒ½æµ‹è¯•
- é•¿æ—¶é—´è¿è¡Œä»£ç æ€§èƒ½æµ‹è¯•

### 6. æ–‡æ¡£æ›´æ–°

#### `tests/README.md` - å®Œæ•´æµ‹è¯•æ–‡æ¡£
åŒ…å«ï¼š
- æµ‹è¯•ç»“æ„è¯´æ˜
- è¿è¡Œæ–¹æ³•æŒ‡å—
- æ ‡è®°ç³»ç»Ÿä»‹ç»
- æœ€ä½³å®è·µå»ºè®®
- æ•…éšœæ’é™¤æŒ‡å—

#### æ›´æ–°çš„ `pytest.ini`
- è®¾ç½®æµ‹è¯•è·¯å¾„ä¸º `tests/`
- æ·»åŠ è¯¦ç»†çš„æ ‡è®°å®šä¹‰
- é…ç½®è¾“å‡ºæ ¼å¼å’Œè¿‡æ»¤å™¨

### 7. ç¯å¢ƒå…¼å®¹æ€§ä¿®å¤

ä¿®å¤äº†è·¯å¾„ç›¸å…³çš„é—®é¢˜ï¼š
- **`sandbox/utils.py`**: ä¿®å¤ `create_secure_temp_dir()` åœ¨æœ¬åœ°ç¯å¢ƒçš„è·¯å¾„é—®é¢˜
- **`sandbox/environment_manager.py`**: ä¿®å¤ç¯å¢ƒç®¡ç†å™¨åœ¨éDockerç¯å¢ƒä¸­çš„è·¯å¾„é—®é¢˜

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿå¼€å§‹
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
./test.sh

# è¿è¡Œå•å…ƒæµ‹è¯•
./test.sh unit

# è¿è¡Œè¯¦ç»†è¾“å‡ºçš„é›†æˆæµ‹è¯•
./test.sh -v integration

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
./test.sh -c all
```

### ä½¿ç”¨Pythonè¿è¡Œå™¨
```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
python run_tests.py unit -v

# è¿è¡Œå¿«é€Ÿæµ‹è¯•
python run_tests.py quick

# ç”Ÿæˆè¦†ç›–ç‡
python run_tests.py all -c
```

### ç›´æ¥ä½¿ç”¨pytest
```bash
# è¿è¡Œç‰¹å®šç±»å‹
pytest -m unit -v
pytest -m "integration and not slow"

# è¿è¡Œç‰¹å®šæ–‡ä»¶
pytest tests/unit/test_security.py -v

# ç”Ÿæˆè¦†ç›–ç‡
pytest --cov=sandbox --cov-report=html
```

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

### å•å…ƒæµ‹è¯•: âœ… 20/20 é€šè¿‡
- `test_security.py`: 8ä¸ªæµ‹è¯•
- `test_utils.py`: 12ä¸ªæµ‹è¯•

### é›†æˆæµ‹è¯•: å·²é‡ç»„
- `test_main.py`: APIç«¯ç‚¹æµ‹è¯•
- `test_timeout.py`: è¶…æ—¶æœºåˆ¶æµ‹è¯•
- `test_api_timeout.py`: APIè¶…æ—¶æµ‹è¯•
- `test_environment.py`: ç¯å¢ƒç®¡ç†æµ‹è¯•ï¼ˆæ–°å¢ï¼‰

### ç³»ç»Ÿæµ‹è¯•: å·²é‡ç»„
- `test_complete_system.py`: å®Œæ•´ç³»ç»Ÿæµ‹è¯•

### æ€§èƒ½æµ‹è¯•: æ–°å¢
- `test_performance.py`: æ€§èƒ½åŸºå‡†æµ‹è¯•

## ğŸ”§ æŠ€æœ¯æ”¹è¿›

1. **æ¨¡å—åŒ–è®¾è®¡**: æŒ‰åŠŸèƒ½åˆ†ç±»ç»„ç»‡æµ‹è¯•
2. **æ ‡è®°ç³»ç»Ÿ**: ä¾¿äºé€‰æ‹©æ€§è¿è¡Œæµ‹è¯•
3. **å¤¹å…·å¤ç”¨**: æé«˜æµ‹è¯•ä»£ç å¤ç”¨æ€§
4. **ç¯å¢ƒé€‚é…**: æ”¯æŒæœ¬åœ°å’ŒDockerç¯å¢ƒ
5. **è¦†ç›–ç‡æ”¯æŒ**: é›†æˆè¦†ç›–ç‡æŠ¥å‘Šç”Ÿæˆ
6. **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜å’Œæœ€ä½³å®è·µ

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

1. **æŒç»­é›†æˆ**: é…ç½®CI/CDæµæ°´çº¿ä½¿ç”¨æ–°çš„æµ‹è¯•ç»“æ„
2. **æµ‹è¯•æ•°æ®**: æ‰©å±• `tests/data/` ç›®å½•çš„æµ‹è¯•æ•°æ®
3. **Mockå¯¹è±¡**: ä¸ºé›†æˆæµ‹è¯•æ·»åŠ Mockå¯¹è±¡ä»¥æé«˜å¯é æ€§
4. **æ€§èƒ½åŸºå‡†**: å»ºç«‹æ€§èƒ½åŸºå‡†æ•°æ®åº“
5. **æµ‹è¯•æŠ¥å‘Š**: é›†æˆæµ‹è¯•æŠ¥å‘Šç”Ÿæˆå·¥å…·

## âœ¨ æ€»ç»“

SimplePySandboxçš„æµ‹è¯•ä»£ç ç°åœ¨å·²ç»å®Œå…¨é‡æ„ä¸ºä¸“ä¸šçš„ã€å¯ç»´æŠ¤çš„ç»“æ„ã€‚æ–°çš„æµ‹è¯•ç»„ç»‡æ–¹å¼æä¾›äº†ï¼š

- ğŸ—ï¸ **æ¸…æ™°çš„ç»“æ„**: æŒ‰æµ‹è¯•ç±»å‹åˆ†ç±»
- ğŸš€ **çµæ´»çš„è¿è¡Œ**: æ”¯æŒå¤šç§è¿è¡Œæ–¹å¼
- ğŸ“ˆ **å®Œæ•´çš„è¦†ç›–**: åŒ…å«å•å…ƒã€é›†æˆã€ç³»ç»Ÿå’Œæ€§èƒ½æµ‹è¯•
- ğŸ“š **è¯¦ç»†çš„æ–‡æ¡£**: å®Œæ•´çš„ä½¿ç”¨æŒ‡å—
- ğŸ”§ **æ˜“äºç»´æŠ¤**: æ ‡å‡†åŒ–çš„pytestç»“æ„

æµ‹è¯•ç³»ç»Ÿç°åœ¨å·²ç»å‡†å¤‡å¥½æ”¯æŒé¡¹ç›®çš„æŒç»­å¼€å‘å’Œè´¨é‡ä¿è¯ï¼
